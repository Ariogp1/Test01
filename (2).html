<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ابزار تبدیل مقیاس</title>
  <style>
    :root { --bg:#0f1320; --card:#161a2b; --muted:#8ea0b9; --text:#eef3ff; --accent:#7aa2ff; }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -10%, #1b2140 0%, var(--bg) 60%), var(--bg);font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; color:var(--text);}
    .wrap{max-width:860px;margin:40px auto;padding:24px}
    h1{font-size:22px;margin:0 0 16px}
    p.desc{margin:0 0 22px;color:var(--muted)}
    .card{background:linear-gradient(180deg, #1a1f36, #121629);border:1px solid #2a2f47; padding:18px;border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
    label{display:block;font-size:12px;color:#aab8d8;margin:0 0 6px}
    select,input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #2b3152;background:#0f1326;color:var(--text);outline:none}
    input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0;}
    .grid{display:grid;gap:16px}
    .hint{font-size:12px;color:#94a3c7}
    .out{background:linear-gradient(180deg, #0f1428, #0b1022);padding:16px;border-radius:14px;border:1px dashed #2f365e}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .big{font-size:28px; font-weight:700}
    .copy{cursor:pointer;border:1px solid #2b3152;background:#0f1326;color:#cdd7ff;border-radius:10px;padding:8px 10px}
    .flex{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .hstack{display:flex; align-items:center; gap:8px}
    .toggle-inline{display:inline-flex; align-items:center; gap:0; white-space:nowrap}
    .toggle-inline .hint{margin:0; line-height:1; padding:0; transform: translateX(-4px);}
    .toggle-inline input[type="checkbox"]{margin:0; padding:0; width:16px; height:16px; vertical-align:middle;}
    .footer{margin-top:16px; color:#90a4d4; font-size:12px}
    .ok{color:#99ffcc}
    .warn{color:#ffd479}
    .ig-link{display:inline-flex;align-items:center;gap:6px;margin-inline-start:8px;color:#cdd7ff;text-decoration:none;border:1px solid #2b3152;padding:4px 8px;border-radius:8px}
    .ig-link:hover{border-color:#7aa2ff}
    .ig{width:14px;height:14px}
    .handle{display:inline-flex; flex-direction:row; align-items:center; gap:0; direction:ltr; white-space:nowrap; line-height:1}
    .handle .at{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; display:inline}
    .swap{position:relative}
    .swap > *{width:100%}
    .swap.manual #scaleSelect{display:none}
    .swap.manual #scaleN{display:block}
    .swap:not(.manual) #scaleSelect{display:block}
    .swap:not(.manual) #scaleN{display:none}
    /* --- Light/Dark theme switch --- */
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .switch{position:relative;cursor:pointer;border:1px solid #2b3152;background:#0f1326;color:var(--text);border-radius:999px;display:inline-flex;align-items:center;justify-content:center;width:54px;height:28px;padding:0}
    .switch span{pointer-events:none}
    .switch .thumb{position:absolute;top:2px;left:2px;width:24px;height:24px;border-radius:999px;background:var(--accent);box-shadow:0 2px 6px rgba(0,0,0,.35);transition:transform .25s ease}
    .switch .icon{position:absolute;top:50%;transform:translateY(-50%);font-size:12px;opacity:.9}
    .switch .icon.sun{left:8px}
    .switch .icon.moon{right:8px}
    .switch[data-mode="light"] .thumb{transform:translateX(26px)}

    /* Light overrides */
    body.light{background:linear-gradient(180deg,#ffffff,#f6f8ff);color:#0d1220}
    body.light .card{background:#ffffff;border-color:#e2e8f0;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    body.light label{color:#56617a}
    body.light select, body.light input{background:#ffffff;border-color:#cbd5e1;color:#0d1220}
    body.light .out{background:#f4f6fb;border-color:#d0d8e6}
    body.light .copy{background:#ffffff;border-color:#cbd5e1;color:#0d1220}
    body.light .hint{color:#64748b}
    body.light .footer{color:#5f6b88}
    body.light .ig-link{color:#334155;border-color:#cbd5e1}
    body.light .ig-link:hover{border-color:#3b82f6}
    body.light .switch{background:#ffffff;border-color:#cbd5e1;color:#0d1220}

    
      /* Force zero gap when both classes present */
    .hstack.toggle-inline{gap:0 !important;}
  .ltr{direction:ltr;text-align:left}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>ابزار تبدیل مقیاس</h1>
      <button id="themeToggle" class="switch" aria-label="تغییر حالت روشن/تاریک" data-mode="dark">
        <span class="icon sun" aria-hidden="true">☀️</span>
        <span class="icon moon" aria-hidden="true">🌙</span>
        <span class="thumb" aria-hidden="true"></span>
      </button>
    </div>
    <p class="desc">واحد دنیای واقعی را انتخاب کنید (همیشه <strong>۱:۱</strong>)، سپس مقیاس هدف <strong>۱:N</strong> و واحد نقشه را برگزینید. مقدار واقعی را وارد کنید تا اندازه روی نقشه محاسبه شود.</p>

    <div class="card grid" role="form" aria-label="فرم مبدّل مقیاس">
      <div class="row-3">
        <div>
          <label for="realUnit">واحد واقعی (۱:۱)</label>
          <select id="realUnit" aria-label="واحد واقعی">
            <option value="mm">میلی‌متر (mm)</option>
            <option value="cm">سانتی‌متر (cm)</option>
            <option value="m" selected>متر (m)</option>
            <option value="km">کیلومتر (km)</option>
            <option value="in">اینچ (in)</option>
            <option value="ft">فوت (ft)</option>
            <option value="yd">یارد (yd)</option>
            <option value="mi">مایل (mi)</option>
            <option value="nmi">مایل دریایی (nmi)</option>
          </select>
        </div>
        <div>
          <label for="scaleSelect">مقیاس هدف — ۱:N</label>
          <div class="grid" style="gap:8px">
            <div id="scaleSwap" class="swap">
              <select id="scaleSelect" aria-label="انتخاب مقیاس">
                <optgroup label="جزئیات (Detail)">
                  <option value="1">۱:۱</option>
                  <option value="2">۱:۲</option>
                  <option value="5">۱:۵</option>
                  <option value="10">۱:۱۰</option>
                </optgroup>
                <optgroup label="نقشه‌های معماری (Plans)">
                  <option value="20">۱:۲۰</option>
                  <option value="25">۱:۲۵</option>
                  <option value="50">۱:۵۰</option>
                  <option value="75">۱:۷۵</option>
                  <option value="100">۱:۱۰۰</option>
                  <option value="125">۱:۱۲۵</option>
                  <option value="150">۱:۱۵۰</option>
                  <option value="200" selected>۱:۲۰۰</option>
                  <option value="250">۱:۲۵۰</option>
                </optgroup>
                <optgroup label="سایت/شهر (Site/Urban)">
                  <option value="400">۱:۴۰۰</option>
                  <option value="500">۱:۵۰۰</option>
                  <option value="1000">۱:۱۰۰۰</option>
                  <option value="2000">۱:۲۰۰۰</option>
                  <option value="5000">۱:۵۰۰۰</option>
                </optgroup>
              </select>
              <input id="scaleN" type="number" min="1" step="1" value="200" aria-label="عدد N مقیاس" class="ltr" />
            </div>
            <label class="hstack toggle-inline">
              <input type="checkbox" id="manualToggle" />
              <span class="hint">ورود مقدار دلخواه مقیاس هدف</span>
            </label>
          </div>
        </div>
        <div>
          <label for="targetUnit">واحد نقشه</label>
          <select id="targetUnit" aria-label="واحد نقشه">
            <option value="mm">میلی‌متر (mm)</option>
            <option value="cm" selected>سانتی‌متر (cm)</option>
            <option value="m">متر (m)</option>
            <option value="km">کیلومتر (km)</option>
            <option value="in">اینچ (in)</option>
            <option value="ft">فوت (ft)</option>
            <option value="yd">یارد (yd)</option>
            <option value="mi">مایل (mi)</option>
            <option value="nmi">مایل دریایی (nmi)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="realValue">اندازه واقعی (فقط عدد)</label>
          <input id="realValue" type="text" inputmode="decimal" placeholder="مثلاً ۱۲٫۵ یا 12.5" aria-label="اندازه واقعی" class="ltr" dir="ltr" />
          <div class="hint" id="realHint">واحد: m</div>
        </div>
        <div>
          <label>اندازهٔ روی نقشه (محاسبه‌شده)</label>
          <div class="out">
            <div class="big mono" id="outVal">—</div>
            <div class="hint" id="outUnit">واحد: cm</div>
            <div class="flex" style="margin-top:8px">
              <button type="button" class="copy" id="copyBtn" title="کپی مقدار">کپی</button>
              <span class="hint" id="copyNote"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <div class="hint">جزئیات مبدل: <span class="mono" id="detail">۱ (واحد واقعی) → ؟ (واحد نقشه) در مقیاس ۱:N</span></div>
        <div class="footer">ساخته شده توسط <strong>Pixel Studio</strong>
          <a class="ig-link" href="https://instagram.com/Pixel_architecture_studio" target="_blank" rel="noopener" aria-label="Instagram: @Pixel_architecture_studio">
            <svg class="ig" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="1.5"></rect>
              <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5"></circle>
              <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"></circle>
            </svg>
            <span class="handle"><span class="at" aria-hidden="true">@</span><span class="mono ltr">pixel_architecture_studio</span></span>
          </a>
        </div>

        </div>
    </div>

    <div class="footer" style="margin-top:10px">نکته: برای مقیاس‌دادن به هندسه در CAD از <span class="mono ltr">scale factor = 1 / N</span> استفاده کنید (مثلاً برای <span class="mono ltr">1:200</span>، ضریب <span class="mono ltr">0.005</span> است). این ابزار تبدیل واحدها را با همین مقیاس انجام می‌دهد.</div>
  </div>

  <script>
    const unitToMM = {
      mm: 1,
      cm: 10,
      m: 1000,
      km: 1000000,
      in: 25.4,
      ft: 304.8,
      yd: 914.4,
      mi: 1609344,
      nmi: 1852000
    };
    const el = (id) => document.getElementById(id);

    const realUnit = el('realUnit');
    const targetUnit = el('targetUnit');
    const scaleSelect = el('scaleSelect');
    const manualToggle = el('manualToggle');
    const scaleSwap = el('scaleSwap');
    const scaleN = el('scaleN');
    const realValue = el('realValue');
    const outVal = el('outVal');
    const outUnit = el('outUnit');
    const realHint = el('realHint');
    const detail = el('detail');
    const copyBtn = el('copyBtn');
    const copyNote = el('copyNote');
    const themeToggle = el('themeToggle');

    function fmt(n){
      if (Number.isNaN(n)) return '—';
      // Show up to 6 decimals, trim trailing zeros
      const s = n.toFixed(6).replace(/\.0+$/,'').replace(/(\.[0-9]*?)0+$/, '$1');
      return s;
    }

    function updateHints(){
      realHint.textContent = `واحد: ${realUnit.value}`;
      outUnit.textContent = `واحد: ${targetUnit.value}`;
    }

    function applyTheme(theme){
      if (theme === 'light') document.body.classList.add('light');
      else document.body.classList.remove('light');
      if (themeToggle){
        const isLight = document.body.classList.contains('light');
        themeToggle.setAttribute('data-mode', isLight ? 'light' : 'dark');
      }
    }

    function initTheme(){
      let theme = localStorage.getItem('theme');
      if (!theme){
        try { theme = (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) ? 'light' : 'dark'; }
        catch(e){ theme = 'dark'; }
      }
      applyTheme(theme);
    }

    function setManualUI(){
      const manual = manualToggle && manualToggle.checked;
      scaleN.disabled = !manual;
      scaleSelect.disabled = manual;
      if (scaleSwap) scaleSwap.classList.toggle('manual', manual);
    }

    function calcDrawing(rv, rU, N, tU){
      const realMM = rv * unitToMM[rU];
      const drawingMM = realMM / N;
      return drawingMM / unitToMM[tU];
    }

    function normalizeNumber(str){
      if (!str) return '';
      var s = String(str);
      var fa = '۰۱۲۳۴۵۶۷۸۹';
      var ar = '٠١٢٣٤٥٦٧٨٩';
      s = s.replace(/[۰-۹]/g, function(d){ return String(fa.indexOf(d)); })
           .replace(/[٠-٩]/g, function(d){ return String(ar.indexOf(d)); });
      s = s.replace(/[٬, ]/g, '');
      s = s.replace(/[٫،]/g, '.');
      s = s.replace(/[^0-9.+-]/g, '');
      return s;
    }

    function compute(){
      const rv = parseFloat(normalizeNumber(realValue.value));
      const manual = manualToggle && manualToggle.checked;
      const N = manual ? parseFloat(scaleN.value) : parseFloat(scaleSelect.value);
      const rU = realUnit.value;
      const tU = targetUnit.value;

      updateHints();

      if (!rv || rv < 0 || !N || N <= 0){
        outVal.textContent = '—';
        const nLabel = (N && N > 0) ? fmt(N) : (manual ? 'N' : (scaleSelect.value || 'N'));
        detail.textContent = `۱ ${rU} → ؟ ${tU} در مقیاس ۱:${nLabel}`;
        return;
      }

      const drawingVal = calcDrawing(rv, rU, N, tU);
      outVal.textContent = `${fmt(drawingVal)} ${tU}`;

      // Also show how many target units equal 1 real unit at this scale
      const oneRealToTarget = (unitToMM[rU] / N) / unitToMM[tU];
      detail.textContent = `۱ ${rU} = ${fmt(oneRealToTarget)} ${tU}  (مقیاس ۱:${fmt(N)})`;
    }

    realUnit.addEventListener('change', compute);
    targetUnit.addEventListener('change', compute);
    scaleSelect.addEventListener('change', compute);
    manualToggle.addEventListener('change', () => { setManualUI(); compute(); });
    scaleN.addEventListener('input', compute);
    realValue.addEventListener('input', compute);
    if (themeToggle) themeToggle.addEventListener('click', function(){
      const isLight = !document.body.classList.contains('light');
      applyTheme(isLight ? 'light' : 'dark');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    });

    copyBtn.addEventListener('click', async () => {
      const raw = outVal.textContent || '';
      let val = raw.trim();
      if (!val || val === '—') {
        copyNote.textContent = 'ابتدا مقدار را محاسبه کنید';
        setTimeout(function(){ copyNote.textContent = ''; }, 1500);
        return;
      }
      // remove unit suffix if present
      const units = ['mm','cm','m','km','in','ft','yd','mi','nmi'];
      for (var i=0;i<units.length;i++){
        var u = units[i];
        if (val.endsWith(' ' + u)) { val = val.slice(0, -(u.length+1)); break; }
      }
      var ok = false;
      if (navigator.clipboard && window.isSecureContext) {
        try { await navigator.clipboard.writeText(val); ok = true; } catch(e) { ok = false; }
      }
      if (!ok) {
        try {
          var ta = document.createElement('textarea');
          ta.value = val;
          ta.style.position = 'fixed';
          ta.style.left = '-1000px';
          ta.style.top = '-1000px';
          ta.style.opacity = '0';
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          try { ta.setSelectionRange(0, ta.value.length); } catch(e){}
          ok = document.execCommand('copy');
          document.body.removeChild(ta);
        } catch(e) { ok = false; }
      }
      copyNote.textContent = ok ? 'کپی شد!' : 'کپی ناموفق';
      setTimeout(function(){ copyNote.textContent = ''; }, 1500);
    });

    

    // Initialize
    initTheme();
    updateHints();
    setManualUI();
    compute();
  </script>
</body>
</html>
